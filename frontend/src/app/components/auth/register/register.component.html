<div class="container mt-5">
  <div class="row justify-content-center">
    <div class="col-md-8 col-lg-6">
      <mat-card>
        <mat-card-header>
          <mat-card-title class="text-center w-100">
            <mat-icon class="register-icon">person_add</mat-icon>
            <h2>Register for Nyerere Marathon 2025</h2>
          </mat-card-title>
        </mat-card-header>
        
        <mat-card-content>
          <form [formGroup]="registerForm" (ngSubmit)="onSubmit()">
            <div class="row">
              <div class="col-md-6">
                <mat-form-field appearance="outline" class="w-100 mb-3">
                  <mat-label>First Name</mat-label>
                  <input matInput formControlName="firstName" placeholder="Enter your first name">
                  <mat-error *ngIf="registerForm.get('firstName')?.hasError('required')">
                    First name is required
                  </mat-error>
                </mat-form-field>
              </div>
              
              <div class="col-md-6">
                <mat-form-field appearance="outline" class="w-100 mb-3">
                  <mat-label>Last Name</mat-label>
                  <input matInput formControlName="lastName" placeholder="Enter your last name">
                  <mat-error *ngIf="registerForm.get('lastName')?.hasError('required')">
                    Last name is required
                  </mat-error>
                </mat-form-field>
              </div>
            </div>

            <mat-form-field appearance="outline" class="w-100 mb-3">
              <mat-label>Email</mat-label>
              <input matInput type="email" formControlName="email" placeholder="Enter your email">
              <mat-icon matSuffix>email</mat-icon>
              <mat-error *ngIf="registerForm.get('email')?.hasError('required')">
                Email is required
              </mat-error>
              <mat-error *ngIf="registerForm.get('email')?.hasError('email')">
                Please enter a valid email
              </mat-error>
            </mat-form-field>

            <mat-form-field appearance="outline" class="w-100 mb-3">
              <mat-label>Phone Number</mat-label>
              <input matInput formControlName="phone" placeholder="Enter your phone number">
              <mat-icon matSuffix>phone</mat-icon>
              <mat-error *ngIf="registerForm.get('phone')?.hasError('required')">
                Phone number is required
              </mat-error>
            </mat-form-field>

            <mat-form-field appearance="outline" class="w-100 mb-3">
              <mat-label>Password</mat-label>
              <input matInput [type]="hidePassword ? 'password' : 'text'" 
                     formControlName="password" placeholder="Enter your password">
              <button mat-icon-button matSuffix (click)="hidePassword = !hidePassword" 
                      type="button" [attr.aria-label]="'Hide password'" 
                      [attr.aria-pressed]="hidePassword">
                <mat-icon>{{hidePassword ? 'visibility_off' : 'visibility'}}</mat-icon>
              </button>
              <mat-error *ngIf="registerForm.get('password')?.hasError('required')">
                Password is required
              </mat-error>
              <mat-error *ngIf="registerForm.get('password')?.hasError('minlength')">
                Password must be at least 6 characters
              </mat-error>
            </mat-form-field>

            <div class="row">
              <div class="col-md-6">
                <mat-form-field appearance="outline" class="w-100 mb-3">
                  <mat-label>Date of Birth</mat-label>
                  <input matInput [matDatepicker]="picker" formControlName="dateOfBirth">
                  <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
                  <mat-datepicker #picker></mat-datepicker>
                  <mat-error *ngIf="registerForm.get('dateOfBirth')?.hasError('required')">
                    Date of birth is required
                  </mat-error>
                </mat-form-field>
              </div>
              
              <div class="col-md-6">
                <mat-form-field appearance="outline" class="w-100 mb-3">
                  <mat-label>Gender</mat-label>
                  <mat-select formControlName="gender">
                    <mat-option value="male">Male</mat-option>
                    <mat-option value="female">Female</mat-option>
                  </mat-select>
                  <mat-error *ngIf="registerForm.get('gender')?.hasError('required')">
                    Gender is required
                  </mat-error>
                </mat-form-field>
              </div>
            </div>

            <mat-form-field appearance="outline" class="w-100 mb-3">
              <mat-label>Nationality</mat-label>
              <input matInput formControlName="nationality" placeholder="Enter your nationality">
              <mat-error *ngIf="registerForm.get('nationality')?.hasError('required')">
                Nationality is required
              </mat-error>
            </mat-form-field>



            <button mat-raised-button color="primary" type="submit" 
                    class="w-100 mb-3" [disabled]="registerForm.invalid || loading">
              <mat-spinner diameter="20" *ngIf="loading"></mat-spinner>
              <span *ngIf="!loading">Register</span>
            </button>

            <!-- Test button for debugging -->
            <button mat-stroked-button color="accent" type="button" 
                    class="w-100 mb-3" (click)="testBackendConnection()">
              Test Backend Connection
            </button>

            <!-- Simple request test button -->
            <button mat-stroked-button color="warn" type="button" 
                    class="w-100 mb-3" (click)="testSimpleRequest()">
              Test Simple Request
            </button>

            <!-- Debug section -->
            <div class="debug-section mt-3 p-3" style="background: #f5f5f5; border-radius: 8px;">
              <h6>Debug Information:</h6>
              <p><strong>API URL:</strong> {{apiUrl}}</p>
              <p><strong>Is Authenticated:</strong> {{isAuthenticated}}</p>
              <p><strong>Token:</strong> {{token ? 'Exists' : 'Not found'}}</p>
              <button mat-button color="primary" (click)="refreshDebugInfo()">
                Refresh Debug Info
              </button>
            </div>
          </form>
        </mat-card-content>
        
        <mat-card-actions class="text-center">
          <p>Already have an account? 
            <a routerLink="/login" class="text-primary">Login here</a>
          </p>
        </mat-card-actions>
      </mat-card>
    </div>
  </div>
</div> 